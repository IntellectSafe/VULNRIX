{% extends "base.html" %}

{% block title %}New Scan - VULNRIX{% endblock %}

{% block content %}
<div class="hacker-theme min-h-screen flex items-center justify-center p-4 relative">
    <div class="scanline"></div>
    
    <div class="card w-full max-w-2xl border-green-500 shadow-lg shadow-green-500/20 bg-black">
        <div class="flex items-center justify-between mb-6 border-b border-green-900 pb-4">
            <h1 class="text-2xl font-bold text-green-500 font-mono glitch" data-text="INITIATE_SCAN"><i class="fas fa-terminal mr-2"></i>INITIATE_SCAN</h1>
            <div class="flex gap-2">
                <span class="w-3 h-3 rounded-full bg-red-500"></span>
                <span class="w-3 h-3 rounded-full bg-yellow-500"></span>
                <span class="w-3 h-3 rounded-full bg-green-500"></span>
            </div>
        </div>

        <form method="POST" id="quick-scan-form" class="space-y-6 font-mono">
            {% csrf_token %}
            <input type="hidden" name="scan_mode" value="advanced_dossier">
            
            <!-- Consolidated Target Dossier Form (Always Visible) -->
            <div id="target-dossier-panel" class="mt-2 animate-in fade-in">
                
                <div class="space-y-2 mb-6 text-center">
                    <p class="text-xs text-green-800 uppercase tracking-widest">--- ENTER_TARGET_VECTORS ---</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="space-y-1">
                        <label class="text-[10px] font-mono text-green-800 uppercase">Target_Full_Name</label>
                        <input type="text" name="name" class="w-full bg-black border border-green-900 text-green-500 p-2 font-mono text-sm focus:border-green-500 outline-none transition-colors placeholder-green-900/50" placeholder="John Doe">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-mono text-green-800 uppercase">Target_Email</label>
                        <input type="email" name="email" class="w-full bg-black border border-green-900 text-green-500 p-2 font-mono text-sm focus:border-green-500 outline-none transition-colors placeholder-green-900/50" placeholder="target@corp.com">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-mono text-green-800 uppercase">Target_Username(s)</label>
                        <input type="text" name="username" class="w-full bg-black border border-green-900 text-green-500 p-2 font-mono text-sm focus:border-green-500 outline-none transition-colors placeholder-green-900/50" placeholder="user1, user2 (comma separated)">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-mono text-green-800 uppercase">Target_Phone</label>
                        <input type="text" name="phone" class="w-full bg-black border border-green-900 text-green-500 p-2 font-mono text-sm focus:border-green-500 outline-none transition-colors placeholder-green-900/50" placeholder="+1-555-0100">
                    </div>
                </div>
                
                <div class="border-t border-green-900/50 my-4"></div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                    <div class="space-y-1">
                        <label class="text-[10px] font-mono text-green-800 uppercase">Infrastructure_Domain</label>
                        <input type="text" name="domain" class="w-full bg-black border border-green-900 text-green-500 p-2 font-mono text-sm focus:border-green-500 outline-none transition-colors placeholder-target-systems.net">
                    </div>
                    <div class="space-y-1">
                        <label class="text-[10px] font-mono text-green-800 uppercase">Infrastructure_IP</label>
                        <input type="text" name="ip" class="w-full bg-black border border-green-900 text-green-500 p-2 font-mono text-sm focus:border-green-500 outline-none transition-colors placeholder-192.168.x.x" placeholder="192.168.1.5">
                    </div>
                </div>
                
                <div class="space-y-2 mb-6">
                    <label class="text-[10px] font-mono text-green-800 uppercase">Social_Vectors_To_Probe</label>
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-2">
                        <label class="cursor-pointer border border-green-900 bg-black p-2 flex items-center gap-2 hover:bg-green-900/20 transition-colors">
                            <input type="checkbox" name="social_platforms" value="twitter" class="accent-green-500">
                            <span class="text-xs text-green-600 font-mono">TWITTER_X</span>
                        </label>
                        <label class="cursor-pointer border border-green-900 bg-black p-2 flex items-center gap-2 hover:bg-green-900/20 transition-colors">
                            <input type="checkbox" name="social_platforms" value="instagram" class="accent-green-500">
                            <span class="text-xs text-green-600 font-mono">INSTAGRAM</span>
                        </label>
                        <label class="cursor-pointer border border-green-900 bg-black p-2 flex items-center gap-2 hover:bg-green-900/20 transition-colors">
                            <input type="checkbox" name="social_platforms" value="linkedin" class="accent-green-500">
                            <span class="text-xs text-green-600 font-mono">LINKEDIN</span>
                        </label>
                        <label class="cursor-pointer border border-green-900 bg-black p-2 flex items-center gap-2 hover:bg-green-900/20 transition-colors">
                            <input type="checkbox" name="social_platforms" value="github" class="accent-green-500">
                            <span class="text-xs text-green-600 font-mono">GITHUB</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Darkweb Module Toggle (Preserved) -->
            <div class="flex items-center justify-end mb-2">
                 <label class="cursor-pointer border border-green-500 bg-green-900/10 px-4 py-2 flex items-center gap-2 hover:bg-green-900/30 transition-all shadow-[0_0_5px_rgba(0,255,0,0.3)] animate-pulse">
                    <input type="checkbox" name="darkweb_check" value="true" checked class="accent-green-500">
                    <span class="text-xs text-green-400 font-mono font-bold tracking-wider glitch" data-text="DARKWEB_ACTIVE"><i class="fas fa-skull mr-1"></i> DARKWEB_MODULE :: ACTIVE</span>
                </label>
            </div>

            <div class="flex justify-center mt-6">
                <button type="submit" class="btn btn--primary w-full border border-green-500 text-green-500 hover:bg-green-500 hover:text-black uppercase font-bold tracking-widest py-3 transition-all shadow-[0_0_10px_rgba(0,255,0,0.1)] hover:shadow-[0_0_20px_rgba(0,255,0,0.6)]">
                    <i class="fas fa-biohazard mr-2"></i> EXECUTE_SCAN
                </button>
            </div>
        </form>
        
        <div class="mt-4 text-center">
             <p class="text-[10px] text-green-900 font-mono">SECURE_CONNECTION_ESTABLISHED // ENCRYPTED_UPLINK_ACTIVE</p>
        </div>
    </div>
</div>


<!-- Full Screen Overlay (Hacker Style) -->
<div id="scan-overlay" class="fixed inset-0 bg-black/95 z-[9999] hidden flex-col items-center justify-center p-4 font-mono">
    <div class="scanline"></div>
    <div class="relative w-32 h-32 mb-8">
        <div class="absolute inset-0 border-4 border-green-500/30 rounded-full animate-ping"></div>
        <div class="absolute inset-0 border-4 border-t-green-500 border-r-transparent border-b-green-500 border-l-transparent rounded-full animate-spin"></div>
        <div class="absolute inset-0 flex items-center justify-center">
            <i class="fas fa-user-secret text-4xl text-green-500 animate-pulse"></i>
        </div>
    </div>
    
    <h2 class="text-2xl font-bold mb-2 text-green-500 glitch" data-text="INFILTRATING_TARGET">INFILTRATING_TARGET</h2>
    <p class="text-green-700 mb-8 blink" id="scan-status-text">INITIALIZING_VECTORS...</p>
    
    <div class="w-full max-w-md bg-green-900/20 border border-green-900 h-4 mb-4 overflow-hidden relative">
        <div class="h-full bg-green-500 shadow-[0_0_10px_#0f0]" id="progress-fill" style="width: 0%"></div>
    </div>
    
    <div class="w-full max-w-lg mt-8 text-xs text-green-800 font-mono text-left p-4 border border-green-900/50 bg-black">
        <div id="terminal-logs">
            <div class="mb-1">> SYSTEM_READY</div>
        </div>
    </div>
</div>

<script>
// (Removed toggle logic and radio button listeners as they are no longer used)

document.getElementById('quick-scan-form').addEventListener('submit', function(e) {
    const overlay = document.getElementById('scan-overlay');
    const progress = document.getElementById('progress-fill');
    const status = document.getElementById('scan-status-text');
    const logs = document.getElementById('terminal-logs');
    
    overlay.classList.remove('hidden');
    overlay.classList.add('flex');
    
    let w = 0;
    const logMessages = [
        "> CONNECTING_TO_DARKNET_RELAYS...",
        "> BYPASSING_FIREWALLS...",
        "> ACQUIRING_DIGITAL_FOOTPRINT...", 
        "> SCRAPING_PUBLIC_LEDGERS...",
        "> CROSS_REFERENCING_LEAK_DBS...",
        "> DECRYPTING_METADATA...",
        "> COMPILING_TARGET_DOSSIER..."
    ];
    
    // Hacker Progress Animation
    const interval = setInterval(() => {
        w += Math.random() * 4;
        if(w > 95) w = 95; // Wait for server redirect
        progress.style.width = w + '%';
        
        // Random Hex Decrypt Effect
        const chars = "0123456789ABCDEF";
        const randomHex = Array(8).fill(0).map(()=>chars[Math.floor(Math.random()*chars.length)]).join('');
        status.innerHTML = `DECRYPTING_BLOCK: 0x${randomHex}`;
        
        // Add Logs
        if (Math.random() > 0.85) {
            const msg = logMessages[Math.floor(Math.random() * logMessages.length)];
            const div = document.createElement('div');
            div.className = "mb-1 text-green-500";
            div.innerText = msg;
            logs.appendChild(div);
            logs.scrollTop = logs.scrollHeight;
        }
    }, 100);
});
</script>
{% endblock %}
